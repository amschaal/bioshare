{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load guardian_tags %}
{% block title %}Shares{% endblock %}
{% block head %}
{{block.super}}
<link rel="stylesheet" type="text/css" href="{% static "lib/datatables/DT_bootstrap.css" %}">
{% endblock %}
{% block content %}
<h2>Search shares</h2>
{% if bad_paths %}
<h3>The following shares have non existent paths. View <a href="{% url 'home' %}">all shares.</a></h3>
{% endif %}

  	<form class="form" action="." method="get">
  	<div class="row">
	  <div class="span6">
		  <div class="control-group">
		    <label class="control-label" >Shared with any of: </label>
		    <!-- 
		    <div class="controls">
			  <label class="inline radio"><input type="radio" name="SHARED_WITH_AND_OR" value="AND"/>All of</label> <label class="inline radio"><input type="radio" name="SHARED_WITH_AND_OR" value="AND"/>Any of</label>			      
		    </div>
		     -->
		  </div>
		  <div class="control-group">
		    <div class="controls">
		      <textarea id="search_users" name="USERS" class="no-margin" type="text" placeholder="joe@example.com, susan@example.com, ..." style="width:400px;height:100px;">{{query.USERS}}</textarea>
		    </div>
		  </div>
	  </div>
  	  <div class="span6">
	  	  <div class="control-group">
		    
		    <div class="controls">
			  <label class="inline">Tags: </label>
			  <label class="inline radio"><input type="radio" name="TAGS_OPERATOR" value="OR" {% if query.TAGS_AND_OR != 'AND' %}checked{% endif %}/>Any of</label>
			  <label class="inline radio"><input type="radio" name="TAGS_OPERATOR" value="AND" {% if query.TAGS_OPERATOR == 'AND' %}checked{% endif %}/>All of</label> 			      
		    </div>
		  </div>
		  <div class="control-group">
		    <div class="controls">
		      <textarea id="search_tags" name="TAGS" class="no-margin" type="text" placeholder="joe@example.com, susan@example.com, ..." style="width:400px;height:100px;">{{query.TAGS}}</textarea>
		    </div>
		  </div>
	  </div>
    </div>
    <button type="submit">Search</button>
	</form>

<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example">
	<thead>
		<tr>
			<th style="width:50%">Share</th>
			<th style="width:25%">Owner</th>
			<th style="width:15%">Created</th>
			<th style="width:10%">Files*</th>
			<th style="width:10%">Size*</th>
		</tr>
	</thead>
	<tbody>
		{% for share in shares%}
		<tr>
			<td data-toggle="tooltip" title="{{share.notes}}"><a {% if not share.path_exists %}class="error" title="The path for this share does not exist"{% endif %} href="{% url 'list_directory' share.slug_or_id %}">{% if not share.path_exists %}<i class="icon-warning-sign"></i> {%endif%}{{share.name}}</a></td>
			<td>{{share.owner.email}}</td>
			<td>{{share.created|date:"m/d/Y"}}</td>
			<td data-toggle="tooltip" title="Last updated: {{share.stats.updated|date:'r'}}">{{share.stats.num_files}}</td>
			<td data-toggle="tooltip" title="Last updated: {{share.stats.updated|date:'r'}}">{{share.stats.hr_size}}</td>
		</tr>
		{% endfor%}
	</tbody>
</table>
<p>
{{total_size}} of storage being used by {{request.user.username}}.*
</p>
*Files statistics updated daily.
{% endblock %}

{% block scripts %}
{{block.super}}
<script>
</script>
<script src="{% static "lib/datatables/jquery.dataTables.min.js" %}"></script>
<script src="{% static "lib/datatables/datatables.filesize.js" %}"></script>
<script src="{% static "lib/datatables/DT_bootstrap.js" %}"></script>
<script src="{% static "lib/textcomplete/jquery.textcomplete.js" %}"></script>
<script src="{% static "js/share/search.js" %}"></script>

<script>
/* Table initialisation */
$(document).ready(function() {
	$('#example').dataTable( {
		//"sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
		"sPaginationType": "bootstrap",
		"oLanguage": {
			"sLengthMenu": "_MENU_ records per page",
			"sSearch": "Filter:"
		},
		"aaSorting": [[ 2, "desc" ]],
		"aoColumns": [
		                null,
		                null,
		                { "sType": "date" },
		                { "sType": "numeric" },
		                { "sType": "file-size" }
		            ]
	} );
} );
</script>
{% endblock %}

