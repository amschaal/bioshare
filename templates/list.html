{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block head %}
{{block.super}}
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="{{ STATIC_URL }}lib/jquery_upload/css/jquery.fileupload-ui.css">
{% endblock %}

{% block title %}Share contents{% endblock %}

{% block content %}
<h2>{{share.name}}</h2>
{% if subdir %}<h3>{{subdir}}</h3> {% endif %}
<!--  <p>
    {{ path }}
  </p>
  <p>
    {{ share.id }}
  </p>
  <p>
    {{ subdir }}
  </p>
  -->  
  <!-- The fileinput-button span is used to style the file input field as button -->
    <span class="btn btn-success fileinput-button">
        <i class="icon-plus icon-white"></i>
        <span>Select files...</span>
        <!-- The file input field used as target for the file upload widget -->
        <input id="fileupload" type="file" name="files[]" multiple>
    </span>
    <a href="#new-folder" role="button" class="btn" data-toggle="modal">New Folder</a>
    <br>
    <br>
    <!-- The global progress bar -->
    <div id="progress" class="progress progress-success progress-striped" style="display:none">
        <div class="bar"></div>
    </div>
    <!-- The container for the uploaded files -->
    <div id="files" class="files"></div>
  <!-- End file upload -->
  <select id="action">
  	<option selected disabled>Action</option>
  	<option value="download">Download</option>
  	<option value="delete">Delete</option>
  </select>
  <a id="launch-action" role="button" class="btn" data-toggle="modal">Go</a>
  <div id="messages"></div>
  <table class="table table-striped table-condensed" id="file-table">
  <thead><tr><th><input type="checkbox" id="toggle-checkbox"/></th><th>Name</th><th>Size</th></tr></thead>
  {% if subdir %}
 	<tr class="directory"><td></td><td><a href="../"><i class="fam-folder"></i>../</a></td><td></td></tr>
  {% endif %}
  {% for dir in directories %}
	<tr class="directory real-directory" data-id="{{dir.name}}"><td><input class="action-check" type="checkbox"/></td><td><a href="{{dir.name}}"><i class="fam-folder"></i>{{ dir.name }}</a></td><td></td></tr>    
  {% endfor %}
  {% for file in files %}
	<tr class="file" data-id="{{file.name}}"><td><input class="action-check" type="checkbox"/></td><td><i class="fam-page-white"></i><a href="{% url 'download_file' share=share.id subpath=subdir|default_if_none:""|add:file.name %}">{{ file.name }}</a></td><td>{{ file.size }}</td></tr>    
  {% endfor %}
  </table>


<div class="modal hide fade" id="new-folder">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>New Folder</h3>
  </div>
  <div class="modal-body">
    <form class="form-horizontal" method="POST" id="new-folder-form" action="{% if subdir %}{% url 'create_folder' share=share.id subdir=subdir %}{% else %}{% url 'create_folder' share=share.id %}{% endif %}">
	    {{ folder_form|crispy }}
  {% csrf_token %}
  </form>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <a href="#" class="btn btn-primary" id="create-folder">Create</a>
  </div>
</div>

{% endblock %}

{% block scripts %}
{{block.super}}
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="{{STATIC_URL}}lib/jquery_upload/js/vendor/jquery.ui.widget.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="{{STATIC_URL}}lib/jquery_upload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="{{STATIC_URL}}lib/jquery_upload/js/jquery.fileupload.js"></script>
<script>
/*jslint unparam: true */
/*global window, $ */
    {% if subdir %}
    var upload_file_url = '{% url 'upload_file' share=share.id subdir=subdir %}';
    var delete_paths_url = '{% url 'delete_paths' share=share.id subdir=subdir %}';
    var archive_files_url = '{% url 'archive_files' share=share.id subdir=subdir %}';
    {% else %}
   	var upload_file_url = '{% url 'upload_file' share=share.id %}';
   	var delete_paths_url = '{% url 'delete_paths' share=share.id %}';
   	var archive_files_url = '{% url 'archive_files' share=share.id %}';
   	{% endif %}
   	var download_file_url = '{% url 'download_file' share=share.id subpath=subdir|default_if_none:""|add:"__file__" %}';
</script>
<script src="{% static "js/share/main.js" %}"></script>
{% endblock%}